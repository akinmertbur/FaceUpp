<%- include('partials/header') %>
<% if (locals.user) { %>
  <h1><%= user.username %></h1>
  <p><%= user.bio %></p>
  <button id="editBioButton" onclick="toggleHideBio()">Edit Bio</button>
  <button id="editUsernameButton" onclick="toggleHideUsername()">Edit Username</button>
  <button id="editEmailButton" onclick="toggleHideEmail()">Edit Email</button>
  <button id="editPasswordButton" onclick="toggleHidePassword()">Edit Password</button>
<% } %>

<form action="/api/users/editBio" method="POST" onsubmit="return validateBioForm()">
  <div class="form-group">
    <input type="hidden" class="form-control hide" name="userId" value="<%= user.id %>">
    <input id="editBioInputField" type="text" class="form-control hide" name="bioText" required>
  </div>
  <button id="saveBioButton" type="submit" class="btn btn-dark hide">Save</button>
</form>

<form action="/api/users/editUsername" method="POST" onsubmit="return validateUsernameForm()">
  <div class="form-group">
    <input type="hidden" class="form-control hide" name="userId" value="<%= user.id %>">
    <input id="editUsernameInputField" type="text" class="form-control hide" name="username" required>
  </div>
  <button id="saveUsernameButton" type="submit" class="btn btn-dark hide">Save</button>
</form>

<form action="/api/users/editEmail" method="POST" onsubmit="return validateEmailForm()">
  <div class="form-group">
    <input type="hidden" class="form-control hide" name="userId" value="<%= user.id %>">
    <input id="editEmailInputField" type="email" class="form-control hide" name="email" required>
  </div>
  <button id="saveEmailButton" type="submit" class="btn btn-dark hide">Save</button>
</form>

<form action="/api/auth/editPassword" method="POST" onsubmit="return validatePasswordForm()">
  <div class="form-group">
    <input id="editPasswordInputField" type="password" class="form-control hide" name="password" required>
  </div>
  <button id="savePasswordButton" type="submit" class="btn btn-dark hide">Save</button>
</form>

<% if (photos && photos.length > 0) { %>
  <div class="photo-gallery">
    <% photos.forEach(photo => { %>
      <div class="photo-item">
        <img src="<%= photo.localUrl %>" alt="Photo">
      </div>
    <% }) %>
  </div>
<% } else { %>
  <p>No photos available.</p>
<% } %>
<a href="/">Home</a>

<script>
  function toggleHideBio() {
    const editBioInputField = document.getElementById('editBioInputField');
    const saveBioButton = document.getElementById('saveBioButton');
    const editBioButton = document.getElementById('editBioButton');

    if (editBioInputField.classList.contains('hide')) {
      editBioInputField.classList.remove('hide');
      saveBioButton.classList.remove('hide');
      editBioButton.classList.add('hide');
    } else {
      editBioInputField.classList.add('hide');
      saveBioButton.classList.add('hide');
      editBioButton.classList.remove('hide');
    }
  }
  
  function toggleHideUsername() {
    const editUsernameInputField = document.getElementById('editUsernameInputField');
    const saveUsernameButton = document.getElementById('saveUsernameButton');
    const editUsernameButton = document.getElementById('editUsernameButton');

    if (editUsernameInputField.classList.contains('hide')) {
      editUsernameInputField.classList.remove('hide');
      saveUsernameButton.classList.remove('hide');
      editUsernameButton.classList.add('hide');
    } else {
      editUsernameInputField.classList.add('hide');
      saveUsernameButton.classList.add('hide');
      editUsernameButton.classList.remove('hide');
    }
  }
  
  function toggleHideEmail() {
    const editEmailInputField = document.getElementById('editEmailInputField');
    const saveEmailButton = document.getElementById('saveEmailButton');
    const editEmailButton = document.getElementById('editEmailButton');

    if (editEmailInputField.classList.contains('hide')) {
      editEmailInputField.classList.remove('hide');
      saveEmailButton.classList.remove('hide');
      editEmailButton.classList.add('hide');
    } else {
      editEmailInputField.classList.add('hide');
      saveEmailButton.classList.add('hide');
      editEmailButton.classList.remove('hide');
    }
  }
  
  function toggleHidePassword() {
    const editPasswordInputField = document.getElementById('editPasswordInputField');
    const savePasswordButton = document.getElementById('savePasswordButton');
    const editPasswordButton = document.getElementById('editPasswordButton');

    if (editPasswordInputField.classList.contains('hide')) {
      editPasswordInputField.classList.remove('hide');
      savePasswordButton.classList.remove('hide');
      editPasswordButton.classList.add('hide');
    } else {
      editPasswordInputField.classList.add('hide');
      savePasswordButton.classList.add('hide');
      editPasswordButton.classList.remove('hide');
    }
  }

  function validateBioForm() {
    const bioText = document.getElementById('editBioInputField').value;
    if (bioText.trim() === '') {
      alert('Bio cannot be empty');
      return false;
    }
    return true;
  }

  function validateUsernameForm() {
    const username = document.getElementById('editUsernameInputField').value;
    if (username.trim() === '') {
      alert('Username cannot be empty');
      return false;
    }
    return true;
  }

  function validateEmailForm() {
    const email = document.getElementById('editEmailInputField').value;
    if (email.trim() === '') {
      alert('Email cannot be empty');
      return false;
    }
    if (!validateEmail(email)) {
      alert('Invalid email format');
      return false;
    }
    return true;
  }

  function validatePasswordForm() {
    const password = document.getElementById('editPasswordInputField').value;
    if (password.trim() === '') {
      alert('Password cannot be empty');
      return false;
    }
    if (password.length < 8) {
      alert('Password must be at least 8 characters long');
      return false;
    }
    return true;
  }

  function validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(String(email).toLowerCase());
  }
</script>
<%- include('partials/footer') %>
